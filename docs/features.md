# 機能一覧

## 機能マトリクス

| 機能 | 優先度 | ステータス | 説明 |
|------|--------|------------|------|
| Googleログイン | P0 | ✅ | Firebase Authentication |
| ホワイトリスト認証 | P0 | ✅ | 登録ユーザーのみアクセス可 |
| Gmail添付取得 | P0 | ✅ | 定期自動取得 |
| AI OCR | P0 | ✅ | Gemini 2.5 Flash |
| **AI要約** | P1 | ✅ | OCR結果からAI要約を生成 |
| 書類一覧表示 | P0 | ✅ | 検索・フィルター付き |
| PDFビューアー | P0 | ✅ | react-pdf |
| PDF分割 | P1 | ✅ | 自動検出 + 手動調整 |
| PDF回転永続保存 | P1 | ✅ | ページ単位/全ページ対応 |
| マスター管理 | P1 | ✅ | CRUD操作 |
| **[エイリアス学習](alias-feature.md)** | P1 | ✅ | 書類種別・顧客・事業所の表記揺れ学習（自動学習・手動登録・CSV一括） |
| エラー履歴 | P1 | ✅ | 再処理機能付き |
| 設定画面 | P1 | ✅ | Gmail/ユーザー管理 |
| 処理履歴ビュー | P1 | ✅ | 日付グルーピング、フィルター |
| 同姓同名解決 | P1 | ✅ | 顧客候補選択、監査ログ |
| **担当CM別ビュー** | P1 | ✅ | ケアマネ別に書類をグルーピング |
| **モバイル対応** | P1 | ✅ | レスポンシブUI、タッチ操作最適化 |
| **PWA対応** | P1 | ✅ | ホーム画面設置、スタンドアロン表示 |
| **OCR確認ステータス** | P1 | ✅ | 書類の確認状況を管理（未確認バッジ・フィルター） |

## 画面一覧

### 1. ログイン画面

```
/login
```

- Googleアカウントでのシングルサインオン
- ホワイトリスト未登録ユーザーはアクセス拒否

### 2. 書類一覧画面

```
/
```

- 統計カード（全書類数、処理完了、処理中、エラー）
- 検索バー
- フィルター（ステータス、書類種別、**未確認のみ表示**）
- 書類テーブル（**確認済みチェックマーク列**: 確認済みの書類のみ✓表示）
- 書類クリックで詳細モーダル

### 3. 書類詳細モーダル

- PDFビューアー（ズーム、ページ送り、**回転の永続保存**）
- メタ情報サイドバー（**モバイルでは折りたたみ可能**）
- **AI要約表示**（OCR結果から自動生成、再生成ボタン付き）
- **OCR結果表示**（アコーディオン式）
- **OCR確認ステータス**: 確認済み/未確認のトグル、確認者・確認日時を記録
- **モバイル対応**: AI要約・OCR結果はポップアップ表示
- PDF分割ボタン
- ダウンロードボタン（**確認ダイアログ付き**）
- **[エイリアス学習](alias-feature.md)**: 編集時に表記揺れを記憶するオプション。未判定時はマスター管理画面への登録ヒントを表示

### 4. PDF分割モーダル

- 分割候補一覧
- 手動分割点追加
- セグメントごとのメタ情報編集
- 分割実行

### 5. エラー履歴画面

```
/errors
```

- エラー一覧テーブル
- エラー種別フィルター
- 再処理ボタン
- 解決済みマーク

### 6. マスター管理画面

```
/masters
```

- 顧客マスター（許容表記/エイリアス対応）
- 書類種別マスター（許容表記/エイリアス対応）
- 事業所マスター（許容表記/エイリアス対応）
- ケアマネジャーマスター
- 各マスターのCRUD操作
- CSV一括インポート（エイリアス列対応）
- テーブルビューで許容表記を一覧表示

### 7. 設定画面

```
/settings
```

- Gmail監視設定
- ユーザー管理（追加・削除・ロール変更）
- 通知設定

### 8. 処理履歴画面

```
/history
```

- 日付別グルーピング表示
- 期間フィルター（今日、1週間、1ヶ月、カスタム）
- ステータスフィルター（処理中、完了、エラー）
- 顧客確定状態フィルター
- バッファリングページネーション

### 9. 同姓同名解決モーダル

- 顧客候補リスト表示（OCR結果から抽出）
- 候補選択による顧客確定
- 「該当なし」オプション
- 監査ログ記録（誰が、いつ、何を選択したか）

### 10. 担当CM別ビュー

```
/caremanagers
```

- ケアマネジャー別に書類をグルーピング表示
- 顧客サブグループ表示
- ワンクリックで書類詳細へ遷移

## API/Functions

### Scheduled Functions（定期実行）

| 関数 | 間隔 | 説明 |
|------|------|------|
| `checkGmailAttachments` | 5分 | Gmail添付ファイル取得（MD5重複チェック付き） |
| `processOCR` | 1分 | OCR処理実行（ポーリング一本化、ADR-0010） |

### Callable Functions（オンデマンド）

| 関数 | 説明 |
|------|------|
| `detectSplitPoints` | PDF分割候補検出 |
| `splitPdf` | PDF分割実行 |
| `rotatePdfPages` | ページ回転（永続保存） |
| `getOcrText` | 大容量OCR結果取得 |
| `regenerateSummary` | AI要約再生成 |
| `searchDocuments` | 全文検索（日付パース対応） |
| `uploadPdf` | ローカルPDFアップロード |
| `deleteDocument` | ドキュメント削除（管理者のみ） |

## ユーザーロール

| ロール | 権限 |
|--------|------|
| `admin` | 全機能アクセス可、ユーザー管理、設定変更 |
| `user` | 書類閲覧、検索、PDF分割 |
