# 機能一覧

## 機能マトリクス

| 機能 | 優先度 | ステータス | 説明 |
|------|--------|------------|------|
| Googleログイン | P0 | ✅ | Firebase Authentication |
| ホワイトリスト認証 | P0 | ✅ | 登録ユーザーのみアクセス可 |
| Gmail添付取得 | P0 | ✅ | 定期自動取得 |
| AI OCR | P0 | ✅ | Gemini 2.5 Flash |
| 書類一覧表示 | P0 | ✅ | 検索・フィルター付き |
| PDFビューアー | P0 | ✅ | react-pdf |
| PDF分割 | P1 | ✅ | 自動検出 + 手動調整 |
| PDF回転永続保存 | P1 | ✅ | ページ単位/全ページ対応 |
| マスター管理 | P1 | ✅ | CRUD操作 |
| エラー履歴 | P1 | ✅ | 再処理機能付き |
| 設定画面 | P1 | ✅ | Gmail/ユーザー管理 |
| 処理履歴ビュー | P1 | ✅ | 日付グルーピング、フィルター |
| 同姓同名解決 | P1 | ✅ | 顧客候補選択、監査ログ |

## 画面一覧

### 1. ログイン画面

```
/login
```

- Googleアカウントでのシングルサインオン
- ホワイトリスト未登録ユーザーはアクセス拒否

### 2. 書類一覧画面

```
/
```

- 統計カード（全書類数、処理完了、処理中、エラー）
- 検索バー
- フィルター（ステータス、書類種別）
- 書類テーブル
- 書類クリックで詳細モーダル

### 3. 書類詳細モーダル

- PDFビューアー（ズーム、ページ送り、**回転の永続保存**）
- メタ情報サイドバー
- PDF分割ボタン
- ダウンロードボタン

### 4. PDF分割モーダル

- 分割候補一覧
- 手動分割点追加
- セグメントごとのメタ情報編集
- 分割実行

### 5. エラー履歴画面

```
/errors
```

- エラー一覧テーブル
- エラー種別フィルター
- 再処理ボタン
- 解決済みマーク

### 6. マスター管理画面

```
/masters
```

- 顧客マスター
- 書類種別マスター
- 事業所マスター
- ケアマネジャーマスター
- 各マスターのCRUD操作

### 7. 設定画面

```
/settings
```

- Gmail監視設定
- ユーザー管理（追加・削除・ロール変更）
- 通知設定

### 8. 処理履歴画面

```
/history
```

- 日付別グルーピング表示
- 期間フィルター（今日、1週間、1ヶ月、カスタム）
- ステータスフィルター（処理中、完了、エラー）
- 顧客確定状態フィルター
- バッファリングページネーション

### 9. 同姓同名解決モーダル

- 顧客候補リスト表示（OCR結果から抽出）
- 候補選択による顧客確定
- 「該当なし」オプション
- 監査ログ記録（誰が、いつ、何を選択したか）

## API/Functions

### Scheduled Functions（定期実行）

| 関数 | 間隔 | 説明 |
|------|------|------|
| `checkGmailAttachments` | 5分 | Gmail添付ファイル取得（MD5重複チェック付き） |
| `processOCR` | 5分 | OCR処理実行 |

### Callable Functions（オンデマンド）

| 関数 | 説明 |
|------|------|
| `detectSplitPoints` | PDF分割候補検出 |
| `splitPdf` | PDF分割実行 |
| `rotatePdfPages` | ページ回転 |
| `getOcrText` | 大容量OCR結果取得 |

## ユーザーロール

| ロール | 権限 |
|--------|------|
| `admin` | 全機能アクセス可、ユーザー管理、設定変更 |
| `user` | 書類閲覧、検索、PDF分割 |
