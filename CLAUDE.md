# DocSplit - æ›¸é¡ç®¡ç†ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚¢ãƒ—ãƒª

## ã‚¢ãƒ—ãƒªæƒ…å ±
| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¢ãƒ—ãƒªå | **DocSplit** |
| ã‚¢ã‚¤ã‚³ãƒ³ | `DocSplit_ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³.png`ï¼ˆãƒ­ãƒœãƒƒãƒˆ + æ›¸é¡ï¼‰ |
| ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ | ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼ï¼ˆ#1a365d ç³»ï¼‰ |

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
AppSheetã§æ§‹ç¯‰ã•ã‚ŒãŸæ›¸é¡ç®¡ç†ã‚¢ãƒ—ãƒªã‚’GCPã§ãƒªãƒ—ãƒ¬ã‚¤ã‚¹é–‹ç™ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚
Gmailã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å–å¾—ã—ã€AI OCRã§ãƒ¡ã‚¿æƒ…å ±ã‚’æŠ½å‡ºã€æ¤œç´¢ãƒ»ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ãƒ»é–²è¦§ãŒå¯èƒ½ãª**æ›¸é¡ç®¡ç†ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚¢ãƒ—ãƒª**ã€‚

## ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 8å®Œäº† - **ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ“ãƒ¥ãƒ¼ï¼ˆ1ä¸‡ä»¶å¯¾å¿œï¼‰**

### ç’°å¢ƒæƒ…å ±
| é …ç›® | å€¤ |
|------|-----|
| GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | `doc-split-dev` |
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | `asia-northeast1` |
| GitHubãƒªãƒã‚¸ãƒˆãƒª | `yasushi-honda/doc-split` |
| Storageãƒã‚±ãƒƒãƒˆ | `doc-split-dev-documents` |
| Firestoreã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ | ãƒãƒ¼ãƒˆ `8085` |
| **æœ¬ç•ªURL** | `https://doc-split-dev.web.app` |

### é–‹ç™ºå®Œäº†ã‚µãƒãƒªãƒ¼

| Phase | å®Œäº†æ—¥ | å†…å®¹ |
|-------|--------|------|
| 0 | 01-18 | GCPç’°å¢ƒæ§‹ç¯‰ã€Firebaseé€£æº |
| 1 | 01-18 | Firestoreã‚¹ã‚­ãƒ¼ãƒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ« |
| 2 | 01-18 | Gmailé€£æºã€OCRå‡¦ç†ï¼ˆGemini 2.5 Flashï¼‰ |
| 3 | 01-18 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReact + shadcn/uiï¼‰ |
| 4 | 01-18 | PDFåˆ†å‰²ã€ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç·¨é›† |
| 5 | 01-18 | ãƒ†ã‚¹ãƒˆã€æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã€é‹ç”¨æ‰‹é †æ›¸ |
| 6 | 01-18 | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ç§»è¡Œï¼ˆ132ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹ï¼‰ |
| 7 | 01-20 | å‡¦ç†å±¥æ­´ã€åŒå§“åŒåè§£æ±º |
| 8 | 01-22 | ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ“ãƒ¥ãƒ¼ã€æ¤œç´¢æ©Ÿèƒ½ |

**è¿½åŠ å®Ÿè£…ï¼ˆ01-22ã€œ02-07ï¼‰**: CI/CDã€ãƒ†ãƒŠãƒ³ãƒˆè‡ªå‹•åŒ–ã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹å­¦ç¿’ï¼ˆæ›¸é¡ç¨®åˆ¥ãƒ»é¡§å®¢ãƒ»äº‹æ¥­æ‰€ï¼‰ã€ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ãƒªã‚¹ãƒˆè‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ã€æœ¬ç•ªé‹ç”¨é–‹å§‹ã€PWAå¯¾å¿œ

> è©³ç´°ã¯ [docs/context/phase-history.md](docs/context/phase-history.md) ã‚’å‚ç…§

## ä»Šå¾Œã®äºˆå®š
- [ ] ç²¾åº¦æ”¹å–„ï¼ˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¾Œï¼‰

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç’°å¢ƒ

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç’°å¢ƒã¯ `.firebaserc` ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
```bash
# ä¸€æ‹¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆGmail OAuthè¾¼ã¿ï¼‰â€»æ¨å¥¨
./scripts/setup-tenant.sh <project-id> <admin-email> --with-gmail

# Claude Code / CIç”¨ï¼ˆéå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ï¼‰
./scripts/setup-tenant.sh <project-id> <admin-email> --yes
./scripts/setup-tenant.sh <project-id> <admin-email> --with-gmail --client-id=X --client-secret=Y --auth-code=Z --yes

# æ®µéšçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
./scripts/setup-tenant.sh <project-id> <admin-email>
./scripts/setup-gmail-auth.sh <project-id>
./scripts/setup-gmail-auth.sh <project-id> --client-id=X --client-secret=Y --auth-code=Z

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¤œè¨¼
./scripts/verify-setup.sh <project-id>

# è¿½åŠ ãƒ‡ãƒ—ãƒ­ã‚¤
./scripts/deploy-to-project.sh <alias>
```

è©³ç´°ã¯ `docs/context/delivery-and-update-guide.md` å‚ç…§ã€‚

### ç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- `.firebaserc`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¨ã‚¤ãƒªã‚¢ã‚¹å®šç¾©
- `frontend/.env.<alias>`: å„ç’°å¢ƒã®Firebaseè¨­å®š

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆï¼ˆAIå‘ã‘ï¼‰

### å½¹å‰²åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | ç”¨é€” | å¯¾è±¡ |
|-------------|------|------|
| `docs/context/` | **é–‹ç™ºç”¨è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆãƒã‚¹ã‚¿ãƒ¼ï¼‰** | AI/é–‹ç™ºè€… |
| `docs/adr/` | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ±ºå®šè¨˜éŒ² | AI/é–‹ç™ºè€… |
| `docs/operation/` | é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè©³ç´° | ç´å“å…ˆç®¡ç†è€… |
| `docs/ç›´ä¸‹` | GitHub Pageså…¬é–‹ç”¨ï¼ˆç°¡ç•¥ç‰ˆï¼‰ | å¤–éƒ¨å‘ã‘ |
| `docs/reference/` | æ—§ã‚·ã‚¹ãƒ†ãƒ å‚ç…§è³‡æ–™ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰ | å¿…è¦æ™‚ã®ã¿ |

### èª­è¾¼å„ªå…ˆé †åº
1. [ç§»è¡Œã‚¹ã‚³ãƒ¼ãƒ—](docs/context/gcp-migration-scope.md) â˜…æœ€é‡è¦
2. [æ©Ÿèƒ½è¦ä»¶](docs/context/functional-requirements.md)
3. [å®Ÿè£…è¨ˆç”»](docs/context/implementation-plan.md)ï¼ˆå„Phaseå®Œäº†æ¡ä»¶ä»˜ãï¼‰
4. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](docs/context/data-model.md)ï¼ˆFirestoreã‚¹ã‚­ãƒ¼ãƒï¼‰
5. [ç´å“ãƒ»ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé‹ç”¨](docs/context/delivery-and-update-guide.md) â˜…é‹ç”¨æ™‚å¿…èª­
6. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](docs/context/error-handling-policy.md)
7. [Geminiãƒ¬ãƒ¼ãƒˆåˆ¶é™](docs/context/gemini-rate-limiting.md)
8. [ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯](docs/context/business-logic.md)
9. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ±ºå®šè¨˜éŒ²](docs/adr/)

**æ³¨æ„**: `docs/ç›´ä¸‹`ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆdata-model.mdç­‰ï¼‰ã¯GitHub Pagesç”¨ã®ç°¡ç•¥ç‰ˆã€‚AIé–‹ç™ºæ™‚ã¯`docs/context/`ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã€‚

## é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
cd frontend && npm run dev

# Firebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿èµ·å‹•
firebase emulators:start

# å…¨ä½“ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build
```

### ãƒ†ã‚¹ãƒˆ
```bash
# Functionså˜ä½“ãƒ†ã‚¹ãƒˆ
cd functions && npm test

# Firestoreãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
cd functions && npm run test:rules

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
cd frontend && npm test
```

### ãƒ‡ãƒ—ãƒ­ã‚¤

**é‡è¦**: ãƒãƒ«ãƒç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯å¿…ãšã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
æ‰‹å‹•ã§`firebase deploy`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`.env.local`ã®è¨­å®šãŒä½¿ã‚ã‚Œã¦èª¤ã£ãŸç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹å±é™ºãŒã‚ã‚‹ã€‚

```bash
# ãƒãƒ«ãƒç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰
./scripts/deploy-to-project.sh dev           # Hostingã®ã¿
./scripts/deploy-to-project.sh <alias>       # Hostingã®ã¿
./scripts/deploy-to-project.sh <alias> --rules  # Hosting + ãƒ«ãƒ¼ãƒ«ï¼ˆâ˜…ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚å¿…é ˆï¼‰
./scripts/deploy-to-project.sh <alias> --full   # å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

# Functionsã®ã¿ï¼ˆç’°å¢ƒå¤‰æ•°ã«ä¾å­˜ã—ãªã„ãŸã‚ç›´æ¥å®Ÿè¡ŒOKï¼‰
firebase deploy --only functions -P dev
firebase deploy --only functions -P <alias>

# ãƒ«ãƒ¼ãƒ«ã®ã¿ï¼ˆåŒä¸Šï¼‰
firebase deploy --only firestore:rules,storage -P dev
firebase deploy --only firestore:rules,storage -P <alias>
```

**âš ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã®åˆ¤æ–­ï¼ˆAIå‘ã‘å¿…èª­ï¼‰**:
| å¤‰æ›´å†…å®¹ | ã‚³ãƒãƒ³ãƒ‰ |
|---------|---------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ | `./scripts/deploy-to-project.sh <alias>` |
| **Firestoreã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´** | `./scripts/deploy-to-project.sh <alias> --rules` |
| Functionså¤‰æ›´ | `./scripts/deploy-to-project.sh <alias> --full` |

**ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã®ä¾‹**: æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆverifiedç­‰ï¼‰ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¨©é™å¤‰æ›´ã€æ–°ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

### ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
frontend/
â”œâ”€â”€ .env.dev          # devç’°å¢ƒè¨­å®šï¼ˆå›ºå®šï¼‰
â”œâ”€â”€ .env.<alias>      # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç’°å¢ƒè¨­å®šï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ã”ã¨ã«ä½œæˆï¼‰
â”œâ”€â”€ .env.local        # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼ˆé€šå¸¸devè¨­å®šï¼‰
â””â”€â”€ .env.example      # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```

**æ³¨æ„**: Viteã¯`.env.local`ã‚’æœ€å„ªå…ˆã§èª­ã¿è¾¼ã‚€ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯è‡ªå‹•ã§æ­£ã—ã„è¨­å®šã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

### ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
```bash
# ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå€‹åˆ¥ï¼‰
FIREBASE_PROJECT_ID=<project-id> node scripts/import-masters.js --customers scripts/samples/customers.csv
FIREBASE_PROJECT_ID=<project-id> node scripts/import-masters.js --documents scripts/samples/documents.csv
FIREBASE_PROJECT_ID=<project-id> node scripts/import-masters.js --offices scripts/samples/offices.csv

# ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®CSVã‚’è‡ªå‹•æ¤œå‡ºï¼‰
FIREBASE_PROJECT_ID=<project-id> node scripts/import-masters.js --all scripts/samples/
```

## ç¢ºå®šäº‹é …
| ã‚«ãƒ†ã‚´ãƒª | é¸å®š |
|---------|------|
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Firestoreï¼ˆç„¡æ–™æ ã€Firebaseçµ±åˆï¼‰ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | Cloud Storageï¼ˆFunctionsé€£æºï¼‰ |
| OCRã‚¨ãƒ³ã‚¸ãƒ³ | Vertex AI Gemini 2.5 Flash (asia-northeast1) |
| ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆ | Cloud Functions (2nd gen) |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ | Firebase Authentication (Google Login) |
| Gmailé€£æº | é–‹ç™º: OAuth 2.0 / æœ¬ç•ª: Service Account + Delegation |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Firebase Hosting + React + Vite + TypeScript + PWA |
| UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª | shadcn/ui + Tailwind CSS |
| PDFãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ | react-pdf (pdf.js) |
| çŠ¶æ…‹ç®¡ç† | Zustand + TanStack Query |
| ç´å“å½¢æ…‹ | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ–¹å¼ï¼ˆé››å½¢ãªã—ï¼‰ |
| ã‚³ã‚¹ãƒˆä¸Šé™ | æœˆé¡3,000å††ä»¥ä¸‹ï¼ˆäºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šæ¸ˆã¿ï¼‰ |

## ãƒãƒ«ãƒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé‹ç”¨

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–¹é‡

doc-split-devï¼ˆé–‹ç™ºãƒ»æ¤œè¨¼ã€SEEDã‚ã‚Šï¼‰ â†’ å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæœ¬ç•ªï¼ˆSEEDãªã—ï¼‰ã€‚`.firebaserc` ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦å…¨ç’°å¢ƒã‚’å®šç¾©ã€‚

### é‹ç”¨ãƒ•ãƒ­ãƒ¼

| ãƒ•ãƒ­ãƒ¼ | æ‰‹é † |
|--------|------|
| åˆæœŸç´å“ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆGCPä½œæˆ â†’ setup-tenant.sh â†’ ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ |
| ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ | dev ã§æ¤œè¨¼ â†’ `firebase deploy -P client-a` â†’ `-P client-b` |
| æ–°è¦è¿½åŠ  | setup-tenant.sh â†’ .firebasercã«è¿½åŠ  |

**è©³ç´°**: `docs/context/delivery-and-update-guide.md` å‚ç…§

### âš ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®é‡è¦æ³¨æ„ç‚¹

**æ ¹æœ¬åŸå› ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç§»è¡Œæ™‚ã®æ•™è¨“ï¼‰**:
- ä»•æ§˜ã®ã€Œå”¯ä¸€ã®å‚ç…§å…ƒã€ãŒãªãæ‰‹ä½œæ¥­ã§æ¨æ¸¬
- ç’°å¢ƒå·®åˆ†ï¼ˆæœ¬ç•ª/æ¤œè¨¼ï¼‰ã®ã‚¬ãƒ¼ãƒ‰ä¸è¶³
- å®Ÿè£…ä»•æ§˜ã¨é‹ç”¨æ‰‹é †ã®ä¹–é›¢

1. **`.env.local` ã®å„ªå…ˆé †ä½å•é¡Œ**
   - Viteã¯ `.env.local` ã‚’ `.env` ã‚ˆã‚Šå„ªå…ˆ
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯å¿…ãš `.env.local` ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
   ```bash
   cp frontend/.env.<ç’°å¢ƒå> frontend/.env.local
   rm -rf frontend/dist && npm run build
   firebase deploy -P <ç’°å¢ƒå> --only hosting
   cp frontend/.env.dev frontend/.env.local  # å¾©å…ƒ
   ```

2. **ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²**
   - ç™»éŒ²å…ˆ: `users` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`allowedUsers` ã§ã¯ãªã„ï¼‰
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID: Firebase Auth UIDï¼ˆemailã§ã¯ãªã„ï¼‰
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå¾Œã«ç™»éŒ²å¯èƒ½ï¼ˆAuth UIDãŒå¿…è¦ãªãŸã‚ï¼‰

3. **auth/unauthorized-domain å¯¾å¿œ**
   - Firebase Console â†’ Authentication â†’ Authorized domains
   - GCP Console â†’ OAuth 2.0 Client â†’ JavaScript origins + Redirect URIs

4. **æœ¬ç•ªç’°å¢ƒã¸ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ç¦æ­¢**
   - æœ¬ç•ªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã¯ã€Œãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãªã—ã€ã‚’é¸æŠ
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰å®Ÿéš›ã®CSVã‚’å—é ˜ã—ã¦ã‹ã‚‰æŠ•å…¥
   - é–‹ç™º/æ¤œè¨¼ç’°å¢ƒã®ã¿ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨å¯
   - **æ³¨æ„**: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ `masters/{type}/items` ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜
     - `masters/customers/items` - é¡§å®¢
     - `masters/documents/items` - æ›¸é¡ç¨®åˆ¥ï¼ˆdocumentTypesã§ã¯ãªã„ï¼‰
     - `masters/offices/items` - äº‹æ¥­æ‰€
     - `masters/caremanagers/items` - ã‚±ã‚¢ãƒãƒï¼ˆå°æ–‡å­—ï¼‰

5. **ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ãƒªã‚¹ãƒˆã«ã‚ˆã‚‹è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³**
   - `settings/auth.allowedDomains` ã«è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®š
   - `setup-tenant.sh` ã¯ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿è‡ªå‹•è¨­å®š
   - è¿½åŠ ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¿…è¦ãªå ´åˆ:
     ```bash
     node scripts/check-allowed-domains.js <project-id> --add <domain>
     # ä¾‹: node scripts/check-allowed-domains.js docsplit-kanameone --add kanameone.com
     ```
   - **2026-01-30ä¿®æ­£**: Firestoreãƒ«ãƒ¼ãƒ«ã®ãƒã‚°ã§æ–°è¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å•é¡Œã‚’ä¿®æ­£æ¸ˆã¿

6. **ğŸš¨ Firestoreãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã®çµ¶å¯¾ç¦æ­¢äº‹é …ï¼ˆADR-0008ï¼‰**
   - **çµ¶å¯¾ã«å®Ÿè¡Œã—ã¦ã¯ã„ã‘ãªã„ã‚³ãƒãƒ³ãƒ‰**:
     ```bash
     # æœ¬ç•ªç’°å¢ƒã§ä»¥ä¸‹ã¯çµ¶å¯¾ç¦æ­¢
     firebase firestore:delete --all-collections
     firebase firestore:delete / --recursive
     ```
   - **è¨±å¯ã•ã‚Œã‚‹å‰Šé™¤æ“ä½œ**ï¼ˆç‰¹å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰:
     ```bash
     firebase firestore:delete documents --recursive -P <alias>
     ```
   - **å‰Šé™¤å‰ã®å¿…é ˆç¢ºèª**:
     - [ ] å‰Šé™¤å¯¾è±¡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åã‚’3å›ç¢ºèª
     - [ ] `--all-collections` ã¯çµ¶å¯¾ã«ä½¿ã‚ãªã„
     - [ ] æœ¬ç•ªç’°å¢ƒã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜
   - **2026-01-30æ•™è¨“**: æœ¬ç•ªç’°å¢ƒã§ `--all-collections` ã‚’èª¤å®Ÿè¡Œã—ã€ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–ªå¤±ã€‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»PITRæœªè¨­å®šã®ãŸã‚å¾©å…ƒä¸å¯èƒ½ã¨ãªã£ãŸã€‚

**ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆè©³ç´°**: `docs/operation/setup-guide.md` å‚ç…§

## æœ¬ç•ªç’°å¢ƒæƒ…å ±
| é …ç›® | URL/æƒ…å ± |
|------|----------|
| ã‚¢ãƒ—ãƒªURL | `https://doc-split-dev.web.app` |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | `https://yasushi-honda.github.io/doc-split/` |
| Firebase Console | `https://console.firebase.google.com/project/doc-split-dev` |
| GCP Console | `https://console.cloud.google.com/home/dashboard?project=doc-split-dev` |
| Functions Logs | `https://console.firebase.google.com/project/doc-split-dev/functions/logs` |

### ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿Cloud Functions
| é–¢æ•°å | ãƒˆãƒªã‚¬ãƒ¼ | èª¬æ˜ |
|--------|----------|------|
| checkGmailAttachments | Scheduled (5åˆ†é–“éš”) | Gmailæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å–å¾— |
| processOCR | Scheduled (1åˆ†é–“éš”) | AI OCRå‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰ |
| processOCROnCreate | Firestore Trigger | AI OCRå‡¦ç†ï¼ˆå³æ™‚å®Ÿè¡Œï¼‰ |
| getOcrText | Callable | OCRå…¨æ–‡å–å¾— |
| detectSplitPoints | Callable | PDFåˆ†å‰²å€™è£œæ¤œå‡º |
| splitPdf | Callable | PDFåˆ†å‰²å®Ÿè¡Œ |
| rotatePdfPages | Callable | PDFãƒšãƒ¼ã‚¸å›è»¢ï¼ˆæ°¸ç¶šä¿å­˜ï¼‰ |
| uploadPdf | Callable | ãƒ­ãƒ¼ã‚«ãƒ«PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| deleteDocument | Callable | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ |
| regenerateSummary | Callable | AIè¦ç´„å†ç”Ÿæˆ |
| searchDocuments | Callable | å…¨æ–‡æ¤œç´¢ï¼ˆæ—¥ä»˜ãƒ‘ãƒ¼ã‚¹å¯¾å¿œï¼‰ |
| onDocumentWriteSearchIndex | Firestore Trigger | æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªå‹•æ›´æ–° |
| onDocumentWrite | Firestore Trigger | ã‚°ãƒ«ãƒ¼ãƒ—ã‚­ãƒ¼è¨­å®šãƒ»é›†è¨ˆæ›´æ–° |

### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é‡è¤‡ãƒã‚§ãƒƒã‚¯ä»•æ§˜
- **ãƒã‚§ãƒƒã‚¯æ–¹å¼**: ãƒ•ã‚¡ã‚¤ãƒ«åãƒ™ãƒ¼ã‚¹ï¼ˆåŒåãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ï¼‰
- **é‡è¤‡æ¤œå‡ºæ™‚**: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§åˆ¥åä¿å­˜ã‚’ææ¡ˆï¼ˆä¾‹: `file.pdf` â†’ `file_2.pdf`ï¼‰
- **åˆ†å‰²å…ƒã®æ‰±ã„**: `isSplitSource=true` ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‹ã‚‰é™¤å¤–
- **Gmailå–ã‚Šè¾¼ã¿**: MD5ãƒãƒƒã‚·ãƒ¥ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•å‡¦ç†ã®ãŸã‚ï¼‰

### æ¤œç´¢æ©Ÿèƒ½ä»•æ§˜
- **æ¤œç´¢æ–¹å¼**: åè»¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + TF-IDF ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- **æ¤œç´¢å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ï¼ˆFIELD_WEIGHTSï¼‰:
  - customerNameï¼ˆé¡§å®¢åï¼‰: é‡ã¿3
  - officeNameï¼ˆäº‹æ¥­æ‰€åï¼‰: é‡ã¿2
  - documentTypeï¼ˆæ›¸é¡ç¨®åˆ¥ï¼‰: é‡ã¿2
  - careManagerï¼ˆã‚±ã‚¢ãƒãƒï¼‰: é‡ã¿1
  - fileNameï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åï¼‰: é‡ã¿1
- **æ¤œç´¢å¯¾è±¡å¤–**: processedAtï¼ˆç™»éŒ²æ—¥ï¼‰ã€fileDateï¼ˆæ›¸é¡æ—¥ä»˜ï¼‰ã€ocrResultï¼ˆOCRçµæœï¼‰
- **æ—¥ä»˜æ¤œç´¢**: ã€Œ2024/1ã€ã€ŒR6.1ã€ãªã©ã®æ—¥ä»˜ãƒ‘ãƒ¼ã‚¹ã§ fileDate ã‚’æ¤œç´¢å¯èƒ½
- **ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚º**: bi-gram + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
doc-split/
â”œâ”€â”€ CLAUDE.md                    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json                 # ãƒ¢ãƒãƒ¬ãƒãƒ«ãƒ¼ãƒˆ
â”œâ”€â”€ firebase.json                # Firebaseè¨­å®š
â”œâ”€â”€ firestore.rules / storage.rules  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
â”œâ”€â”€ .github/workflows/           # CI/CDï¼ˆci.yml, deploy.ymlï¼‰
â”œâ”€â”€ frontend/                    # Reactãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/          # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ19ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/              # shadcn/uiï¼ˆ21ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ views/           # ãƒ“ãƒ¥ãƒ¼ç³»ï¼ˆGroupList, GroupDocumentList, CustomerSubGroupï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentDetailModal / PdfViewer / PdfSplitModal  # è©³ç´°ãƒ»PDFç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ PdfPageThumbnail / PdfSplitPreview / PdfUploadModal  # PDFæ“ä½œç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ CsvImportModal / MasterSelectField / RegisterNewMasterModal  # ãƒã‚¹ã‚¿ãƒ¼ç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchBar / DateRangeFilter / KanaFilterBar  # æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout / LoadMoreIndicator / AliasLearningHistoryModal  # å…±é€šUI
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/       # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ hooks/               # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆ13ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ useDocuments / useDocumentGroups / useDocumentEdit  # æ›¸é¡ç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ useDocumentVerification / useInfiniteScroll  # ç¢ºèªãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
â”‚   â”‚   â”‚   â”œâ”€â”€ useSearch / useMasters / useMasterAlias / useAliasLearningHistory  # æ¤œç´¢ãƒ»ãƒã‚¹ã‚¿ãƒ¼ç³»
â”‚   â”‚   â”‚   â”œâ”€â”€ useErrors / useProcessingHistory / useSettings  # ç®¡ç†ãƒ»è¨­å®šç³»
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/       # ãƒ•ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ pages/               # å„ç”»é¢ï¼ˆ8ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ DocumentsPage / MastersPage / AdminPage / LoginPage ç­‰
â”‚   â”‚   â”œâ”€â”€ stores/              # Zustandï¼ˆauthStore.tsï¼‰
â”‚   â”‚   â”œâ”€â”€ lib/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ firebase.ts / csvParser.ts / csvTemplates.ts
â”‚   â”‚   â”‚   â””â”€â”€ documentUtils.ts / kanaUtils.ts / textNormalizer.ts / utils.ts
â”‚   â”‚   â””â”€â”€ utils/               # è¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆdisplayName.tsï¼‰
â”‚   â”œâ”€â”€ public/                  # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPWAã‚¢ã‚¤ã‚³ãƒ³ã€faviconç­‰ï¼‰
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ functions/                   # Cloud Functions
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts             # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆï¼ˆå…¨é–¢æ•°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰
â”‚   â”‚   â”œâ”€â”€ gmail/ ocr/ pdf/ search/ upload/  # å„æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ documents/ admin/    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ“ä½œãƒ»ç®¡ç†è€…å‘ã‘
â”‚   â”‚   â”œâ”€â”€ triggers/            # onDocumentWrite, onDocumentWriteSearchIndex
â”‚   â”‚   â””â”€â”€ utils/               # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ test/                    # ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ scripts/                     # é‹ç”¨ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ19ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ setup-tenant.sh          # ãƒ†ãƒŠãƒ³ãƒˆåˆæœŸè¨­å®šï¼ˆæ¨å¥¨: --with-gmail --yesï¼‰
â”‚   â”œâ”€â”€ setup-gmail-auth.sh / setup-gmail-service-account.sh  # Gmailèªè¨¼è¨­å®š
â”‚   â”œâ”€â”€ init-project.sh          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
â”‚   â”œâ”€â”€ deploy-to-project.sh / deploy-all-clients.sh  # ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚   â”œâ”€â”€ import-masters.js        # ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆCLIï¼‰
â”‚   â”œâ”€â”€ add-admin-user.js        # ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
â”‚   â”œâ”€â”€ seed-e2e-data.js         # E2Eãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
â”‚   â”œâ”€â”€ gmail-oauth-cli.py       # Gmail OAuth CLIãƒ„ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ check-allowed-domains.js / verify-setup.sh  # æ¤œè¨¼ãƒ»ç®¡ç†
â”‚   â”œâ”€â”€ run-e2e-tests.sh         # E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
â”‚   â”œâ”€â”€ reprocess-master-matching.js  # ãƒã‚¹ã‚¿ãƒ¼å†ãƒãƒƒãƒãƒ³ã‚°
â”‚   â”œâ”€â”€ migrate-*.js             # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¾¤
â”‚   â””â”€â”€ samples/                 # CSVã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ shared/                      # å…±é€šå‹å®šç¾©ï¼ˆtypes.tsï¼‰
â””â”€â”€ docs/
    â”œâ”€â”€ context/                 # é–‹ç™ºç”¨è©³ç´°ï¼ˆãƒã‚¹ã‚¿ãƒ¼ï¼‰
    â”œâ”€â”€ operation/               # é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ adr/                     # ADRï¼ˆ0001ã€œ0009ï¼‰
    â”œâ”€â”€ audit/ handoff/ reference/  # ç›£æŸ»ãƒ»ãƒãƒ³ãƒ‰ã‚ªãƒ•ãƒ»æ—§ã‚·ã‚¹ãƒ†ãƒ å‚ç…§
```
